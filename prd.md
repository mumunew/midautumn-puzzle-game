# 拼图游戏 PRD（产品需求文档）

## 1. 项目概述
- 目标：开发一个基于 HTML、CSS、JavaScript 的拼图游戏，支持多难度选择与图片选择，并记录用户游戏信息。
- 平台：Web（PC 与移动端自适应）。
- 后端：Node.js 提供静态资源与用户信息记录接口。

## 2. 功能需求
### 2.1 游戏功能
- 难度级别：
  - 简单：3×3
  - 中等：4×4
  - 困难：5×5
- 图片选择：用户可从预设的 JPG 图片中选择（图片预置在服务器目录）。
- 交互机制：拼图块采用“取出/放入”机制（非拖拽到固定区域）。
  - 拼图块初始化在暂存区（乱序）。
  - 用户点击拼图块可“取出”（记为持有状态，显示在鼠标附近的预览）。
  - 点击目标位置可“放入”拼图块。
  - 拼图块可放回暂存区或放入拼图区。
- 完成反馈：所有拼图块正确放置后，显示完成提示与用时。
- 控制：提供“重新开始”和“更换图片”选项。

### 2.2 图片管理
- 服务器预置多张 JPG 图片。
- 前端通过接口获取可选图片列表。
- 图片加载快速，前端以背景定位切图，避免大开销与兼容性问题。

### 2.3 用户信息记录
- 记录方式：TXT 文本，按行存储 JSON（JSON Lines）。
- 字段：登录时间（ISO 字符串）、游戏时长（毫秒）、IP 地址（由服务器端解析）。
- 简化登录流程：无需注册，进入页面即视为一次会话（前端会记录登录时间并在完成时上报）。

### 2.4 界面要求
- 简洁直观的 UI，操作区与游戏区分离。
- 响应式布局，适配不同设备尺寸。

## 3. 技术架构
### 3.1 前端技术栈
- HTML5：页面结构。
- CSS3：样式与动画。
- JavaScript：游戏逻辑与交互（原生，尽量少依赖）。

### 3.2 后端需求
- Node.js + Express：
  - 静态文件服务（/public）。
  - /api/images：返回图片文件列表（JPG/JPEG）。
  - /api/log：记录用户信息到 TXT（JSON Lines）。
- 数据目录：/data/logs.txt。

### 3.3 数据存储
- 图片资源：存储于 /public/assets/images/。
- 用户数据：TXT 文件（/data/logs.txt），每行一个 JSON 对象。

## 4. 开发规范
### 4.1 逻辑分层（洋葱模型）
- 外层（UI 界面层）：负责展示与操作控件（选择图片、难度、按钮、提示）。
- 中层（游戏逻辑层）：生成拼图、乱序、取出/放入、正确性校验、计时。
- 内层（数据管理层）：接口通信、日志记录、图片列表读取。

### 4.2 代码组织原则
- 模块化与功能分离（UI、逻辑、数据通信分文件）。
- 最小化体积与依赖，避免前端暴露敏感信息。
- 安全：不在前端出现任何 API Key 等敏感信息。

## 5. 安全要求
- 仅统计 IP，不做其他用途。
- 服务端追加 IP 字段，前端不传输敏感信息。

## 6. 游戏交互设计
### 6.1 取出/放入机制细化
- 暂存区：包含所有乱序的拼图块。
- 取出：点击暂存区或棋盘上的拼图块，将其置为“持有状态”，并在鼠标附近显示预览。
- 放入：点击棋盘目标格，若持有拼图块则放入；若该格已有拼图块，则原拼图块回到暂存区或进入持有状态以便进一步操作（实现为交换或回暂存区的简化流程）。
- 放回：点击暂存区空白区域或专用按钮可将持有拼图块放回暂存区。

### 6.2 游戏流程
1. 选择图片与难度。
2. 根据选择生成拼图并乱序放入暂存区。
3. 用户从暂存区取出拼图块并放入棋盘对应位置。
4. 系统在每次放入后验证棋盘所有格的正确性。
5. 全部正确后，显示完成提示与用时；前端上报日志到后端。

## 7. 用户体验目标
- 三步开始游戏：选择图片 → 选择难度 → 开始游戏。
- 加载快速、响应流畅。
- UI 元素清晰可理解；移动端点击区域足够大。

## 8. 扩展性
- 预留图片上传接口（后端未来扩展）。
- 预留积分系统入口（前端预留积分展示位与逻辑钩子）。

## 9. 接口定义（初版）
- GET /api/images
  - 响应：{ images: string[] }，返回可访问的图片相对路径（/assets/images/foo.jpg）。
- POST /api/log
  - 请求体：{ loginTime: string, gameDurationMs: number, image: string, difficulty: number }
  - 响应：{ ok: true }
  - 服务器端追加：ip 字段，并将整条记录写入 /data/logs.txt，每行一个 JSON。

## 10. 验收标准
- 三种难度正常工作，完成时正确提示用时。
- 至少一张图片可以选择并正常进行拼图。
- 取出/放入机制交互自然，移动端可用。
- 后端日志写入成功，包含 IP。
- 无敏感信息暴露在前端。