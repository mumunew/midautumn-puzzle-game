/* 基础样式与布局 */
:root {
  --bg: #f2f2f7;
  --text: #1c1c1e;
  --primary: #0a84ff;
  --muted: #6e6e73;
  --border: #d2d2d7;
}
* { box-sizing: border-box; }
html, body { height: 100%; }
body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Microsoft YaHei", sans-serif; background: var(--bg); color: var(--text); }
.header { padding: 20px; text-align: center; background: #fff; border-bottom: 1px solid var(--border); box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
.container { max-width: 1100px; margin: 0 auto; padding: 16px; }
.controls { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; background: #fff; padding: 16px; border: 1px solid var(--border); border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
.controls .control-group { display: flex; flex-direction: column; gap: 6px; }
.controls .buttons { grid-column: 1 / -1; display: flex; gap: 8px; }
.controls .status { grid-column: 1 / -1; display: flex; gap: 16px; align-items: center; color: var(--muted); }
button { padding: 10px 14px; border: none; border-radius: 8px; background: #fff; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.06); transition: background 0.2s, transform 0.05s; }
button:hover { background: #f9f9fb; }
button:active { transform: translateY(1px); }
button:disabled { opacity: 0.6; cursor: not-allowed; }

.game-area { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-top: 16px; }
.board { position: relative; background: #fff; border: 1px solid var(--border); border-radius: 12px; min-height: 420px; display: grid; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
.stash { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
.pieces { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
.piece { position: relative; width: 100%; padding-top: 100%; border: 1px solid var(--border); border-radius: 8px; background-repeat: no-repeat; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
.piece.held { outline: 3px solid var(--primary); box-shadow: 0 0 0 4px rgba(10,132,255,0.15); }
.cell { position: relative; width: 100%; padding-top: 100%; border: 1px solid var(--border); border-radius: 8px; background-color: #fafafa; cursor: pointer; transition: background 0.2s; }
.cell:hover { background-color: #f7f7f9; }
.cell .piece { position: absolute; inset: 0; padding: 0; border: none; border-radius: 8px; }

/* 响应式 */
@media (max-width: 900px) {
  .game-area { grid-template-columns: 1fr; }
  .pieces { grid-template-columns: repeat(4, 1fr); }
  
  /* 移动设备优化 */
  .container { padding: 12px; }
  .controls { padding: 12px; gap: 8px; }
  .controls .buttons { gap: 6px; }
  button { padding: 12px 16px; font-size: 16px; }
  
  /* 增大触摸区域 */
  .piece { min-height: 60px; }
  .cell { min-height: 60px; }
}

@media (max-width: 600px) {
  .pieces { grid-template-columns: repeat(3, 1fr); }
  
  /* 小屏幕进一步优化 */
  .container { padding: 8px; }
  .header { padding: 15px; }
  .header h1 { font-size: 24px; }
  
  /* 更大的触摸区域 */
  .piece { min-height: 70px; }
  .cell { min-height: 70px; }
  button { padding: 14px 18px; font-size: 18px; }
  
  /* 优化游戏区域布局 */
  .board { min-height: 300px; }
  .stash { padding: 8px; }
}

/* 触摸设备专用样式 */
@media (hover: none) and (pointer: coarse) {
  /* 移除hover效果，避免触摸设备上的问题 */
  .piece:hover { transform: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
  .cell:hover { background-color: #fafafa; }
  button:hover { background: linear-gradient(135deg, #3498db, #2980b9); transform: none; }
  
  /* 增强触摸反馈 */
  .piece:active { transform: scale(0.95); }
  button:active { transform: scale(0.98); }
  
  /* 防止文本选择 */
  * { 
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }
  
  /* 优化触摸滚动 */
  body { 
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
  }
  
  .piece, .cell {
    touch-action: none; /* 允许拖拽操作 */
  }
}

/* 拖拽相关样式 */
.piece {
  cursor: grab;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.piece:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.piece.dragging {
  cursor: grabbing;
  opacity: 0.8;
  transform: rotate(5deg) scale(1.1);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  z-index: 1000;
}

/* 移动设备触摸反馈 */
.piece.touch-feedback {
  transform: scale(1.1);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.cell.drag-over,
#pieces.drag-over {
  background-color: rgba(0, 122, 255, 0.1);
  border: 2px dashed #007AFF;
  transform: scale(1.02);
}

.cell {
  transition: all 0.2s ease;
}

/* 移除原有的held样式 */
.piece.held {
  /* 移除这个样式，因为不再使用点击选中 */
}

body {
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  color: #2c3e50;
}

#board {
  border: 2px solid #34495e;
  background: rgba(255, 255, 255, 0.95);
}

.cell {
  background-color: rgba(52, 73, 94, 0.1);
  border: 1px solid #bdc3c7;
}

.piece {
  border: 2px solid #e74c3c;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

button {
  background: linear-gradient(135deg, #3498db, #2980b9);
  color: white;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

button:hover {
  background: linear-gradient(135deg, #2980b9, #1f618d);
  transform: translateY(-1px);
}

button:disabled {
  background: #95a5a6;
  color: #7f8c8d;
}

#message {
  color: #2c3e50;
  font-weight: 700;
  text-shadow: 0 1px 3px rgba(255,255,255,0.8);
  background: rgba(255,255,255,0.9);
  padding: 8px 16px;
  border-radius: 6px;
  display: inline-block;
}

.header h1 {
  color: #ff6b35;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.controls {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
}

.stash h3 {
  color: #34495e !important;
}

#timer {
  color: #2c3e50;
  font-weight: 600;
  background: rgba(255,255,255,0.9);
  padding: 4px 12px;
  border-radius: 4px;
}